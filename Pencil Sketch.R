install.packages('imager')
install.packages('dplyr')
install.packages('scales')
install.packages('TSP')
library(imager)
library(dplyr)
library(ggplot2)
library(scales)
library(TSP)

# Downloa d the image
#urlfile="https://www.pinterest.com/pin/729231364635478464/"
urlfile="http://ereaderbackgrounds.com/movies/bw/Frankenstein.jpg"
file="frankenstein.jpg"
#file="hanuman.jpg"
if (!file.exists(file)) download.file(urlfile, destfile = file, mode = 'wb')

# Load, convert to grayscale, filter image (to convert it to bw) and sample
load.image(file) %>% 
  grayscale() %>%  
  as.matrix -> X

# Convert the matrix to data frame 
dimnames(X) = list(row = 1:nrow(X), col = 1:ncol(X))
X <- reshape2::melt(X)
colnames(X)=c("x","y","value")  

# Start ggplot
plot=ggplot()  

# This loop adds layers to the plot
for (i in 1:500)
{
  # Weighted sample of pixels
  X %>% 
    sample_n(400, weight=1-value) %>% 
    select(x,y) -> data
  
  # Compute distances and solve TSP
  as.TSP(dist(data)) %>% 
    solve_TSP(method = "arbitrary_insertion") %>% 
    as.integer() -> solution
  
  # Rearrange the original points according the TSP output
  data_to_plot <- data[solution,]
  
  # Add a new layer to prevous plot
  plot + geom_path(aes(x,y), data=data_to_plot, alpha=runif(1, min=0, max=0.1))->plot  
}  

# The final plot (at last)
plot +
  scale_y_continuous(trans=reverse_trans())+
  coord_fixed()+
  theme_void()

# Do you like the result? Save it! (Change the filename if you want)
ggsave("franky_scribbles.png", dpi=600, width = 4, height = 5)